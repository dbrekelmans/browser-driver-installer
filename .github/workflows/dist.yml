name: Add PHAR Distribution

on:
  pull_request:
    branches:
      - master
    paths-ignore:
      - ".dist/**"

jobs:
  phar:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: shivammathur/setup-php@v2
        with:
          php-version: 7.4
          extensions: zip
          coverage: none
          tools: phive
      - id: composer-cache
        run: echo "::set-output name=dir::$(composer config cache-files-dir)"
      - uses: actions/cache@v2
        with:
          path: ${{ steps.composer-cache.outputs.dir }}
          key: ${{ runner.os }}-composer-${{ hashFiles('**/composer.lock') }}
          restore-keys: |
            ${{ runner.os }}-composer-
      - run: composer install --no-interaction --no-dev --optimize-autoloader
      - run: phive install --force-accept-unsigned
      - run: .phive/tools/box compile
      - uses: EndBug/add-and-commit@v5
        with:
          author_name: DaniÃ«l Brekelmans
          author_email: dbrekelmans@users.noreply.github.com
          message: "Update PHAR distribution"
          add: ".dist/*"
